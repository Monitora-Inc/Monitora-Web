<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servidores</title>
    <link rel="icon" href="./assets/logos/logo_vetorizada.svg" type="image/x-icon">
    <link rel="stylesheet" href="../../style/sidebar.css">
    <link rel="stylesheet" href="../../style/essencial.css">
    <link rel="stylesheet" href="../../style/tela_usuarios.css">
    <link rel="stylesheet" href="../../style/filtros.css">
    <link rel="stylesheet" href="../../style/popup.css">
</head>

<body onload="listarUsuarios()">
    <nav id="id_sidebar"></nav>
    <div id="id_info_kpis"></div>
    <div id="popup_screen"></div>


    <div class="page_content">
        <!-- Info-card -->
        <div class="headers">
            <div class="card_adicionar" onclick="popup_cadastrar_usuario()">
                <img src="../../assets/icons/icone_usuarioAdicionar.svg" alt="">
                <h2>Adicionar Usuário</h2>
            </div>
            <div class="info-card">
                <h2>Total Usuários:</h2>
                <h1 id="totalUsuarios">0</h1>
            </div>
            <div class="icone_deletar">
                <img src="../../assets/icons/icone_deletar.svg" alt="" onclick="popup_deletar_usuario()">
            </div>
        </div>

        <!-- Filtros de persquisa -->
        <div class="filtros">
            <img class="icones_filtros icone_filtro" alt="">
            <select id="id_filtro" onchange="">
                <option value="filtro_nivel_de_risco_crescente">Todos os Cargos</option>
            </select>
            <img class="icones_filtros icone_pesquisar" alt="">
            <input type="search" placeholder="Digite para pesquisar">
        </div>

        <!-- Lista de Usuários -->

        <div class="container_usuarios">
            <div id="lista_usuarios" class="lista_usuarios">
                <h2 class="lista_titulo">Usuários</h2>
                <!-- Checkbox -->
                <div class="card_usuario" id="1">

                    <div class="usuario_card_inicio">
                        <!-- Checkbox -->
                        <div id="usuario_checkbox">
                        <input type="checkbox" class="checkbox">
                        </div>

                        <!-- Foto -->
                        <div id="usuario_foto">
                            <img src="../../assets/fotosPerfil/fotoPerfil.png" alt="">
                        </div>

                        <!-- Nome e Celular -->
                        <div class="nome_contato">
                            <p id="usuario_nome">Baltazar Bernado</p>
                            <p id="usuario_telefone">1191710375</p>
                        </div>
                    </div>
                    
                    
                    <p id="usuario_email">baltazarbernado@gmail.com</p>
                    <p id="usuario_dataCadastro">24/07/2025</p>

                    <select id="usuario_cargo" onchange="alterar_cargo()">
                        <option value="filtro_nivel_de_risco_crescente">Usuário</option>
                        <option value="filtro_nivel_de_risco_decrescente" selected>ADM</option>
                    </select>
                </div>

            </div>
        </div>
    </div>
</body>

</html>
<script src="../../js/sidebar.js"></script>
<script src="../../js/popups.js"></script>
<script>
    function listarUsuarios() {
        let idEmpresa = sessionStorage.empresaId;

        fetch(`/usuarios/buscarUsuarios/${idEmpresa}`, {
            method: 'GET',
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (response) {
            if (!response.ok) {
                throw new Error(`Erro HTTP: ${response.status}`);
            }
            return response.json();
        }).then(function (dadosUsuarios) {
            console.log(dadosUsuarios);
            for (let i = 0; i < dadosUsuarios.length; i++) {
                let data = dadosUsuarios[i].data_cadastro.split('T');
                let partes = data[0].split('-');
                let dataFormatada = `${partes[2]}/${partes[1]}/${partes[0]}`;
                lista_usuarios.innerHTML += `
                <div class="card_usuario" id="${dadosUsuarios[i].idUsuario}">

                    <div class="usuario_card_inicio">
                        <!-- Checkbox -->
                        <div id="usuario_checkbox">
                        <input type="checkbox" class="checkbox">
                        </div>

                        <!-- Foto -->
                        <div id="usuario_foto">
                            <img src="../../assets/fotosPerfil/fotoPerfil.png" alt="">
                        </div>

                        <!-- Nome e Celular -->
                        <div class="nome_contato">
                            <p id="usuario_nome">${dadosUsuarios[i].nome} ${dadosUsuarios[i].sobrenome}</p>
                            <p id="usuario_telefone">${dadosUsuarios[i].telefone}</p>
                        </div>
                    </div>
                    
                    
                    <p id="usuario_email">${dadosUsuarios[i].email}</p>
                    <p id="usuario_dataCadastro">${dataFormatada}</p>

                    <select id="usuario_cargo" onchange="alterar_cargo()">
                        <option value="filtro_nivel_de_risco_crescente">Usuário</option>
                        <option value="filtro_nivel_de_risco_decrescente" selected>ADM</option>
                    </select>
                </div>
                <!-- <div class="card_usuario" id="${dadosUsuarios[i].idUsuario}" onclick="popup_usuario(this, this.id)">
                    <div id="usuario_foto">
                        <img src="./assets/fotosPerfil/fotoPerfil.png" alt="">
                    </div>
                    <p id="usuario_nome">${dadosUsuarios[i].nome} ${dadosUsuarios[i].sobrenome}</p>
                    <p id="usuario_cargo">${dadosUsuarios[i].nome_cargo}</p>
                    <p id="usuario_email">${dadosUsuarios[i].email}</p>
                    <p id="usuario_telefone">${dadosUsuarios[i].telefone}</p>
                    <p id="usuario_dataCadastro">${dataFormatada}</p>
                </div> -->`
            }
            totalUsuarios.innerHTML = dadosUsuarios.length;
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function alterar_cargo(){

    };

    function deletar_usuario(){

    }
</script>