<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Ally</title>
  <link rel="icon" href="../../assets/logos/logo_vetorizada.svg" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../style/sidebar.css">
  <link rel="stylesheet" href="../../style/popup.css">
  <link rel="stylesheet" href="../../style/Ally.css">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>

<body onload="listarPermissoesReload()">
  <nav id="id_sidebar"></nav>
  <div id="id_info_kpis"></div>
  <div id="popup_screen"></div>
  <h1 class="titulo">Mapeamento global</h1>
  <div class="container">

    <div class="rankingDataCenter">
      <h2 class="tituloRank">Ranking Datacenters</h2>
      <div id="rankDatacenter" class="rankDatacenter">
      </div>
    </div>

    <div class="direita">
      <div id="map" class="mapLeaflet">
      </div>

      <div id="grafico_radar" class="grafico_radar">
        <div class="grafico_esquerda">
          <h3>GrÃ¡fico comparativo</h3>
          <div class="card">
            <select id="selectDataCenter" onchange="mudarDatacenter()">
            </select>
            <div class="kpis">
              <p>Saude: <span id="Saude"></span>%</p>
              <p>Rede: <span id="Rede"></span>%</p>
              <p>Disco: <span id="Disco"></span>%</p>
              <p>CPU: <span id="Cpu"></span>%</p>
              <p>RAM: <span id="Ram"></span>%</p>
            </div>
          </div>
        </div>
        <canvas id="radarChart" class="grafico"></canvas>
      </div>
    </div>
  </div>
  <button onclick="popUp_IA()" class="logo_Ia"><img src="../../assets/logos/logo_vetorizada_branca.svg" alt=""></button>
  <div class="popup_IA">
    <h2>Dicas IA Monitora</h2>
    <div class="MensagemIA">
      <p> ðŸ”„ RedistribuiÃ§Ã£o recomendada: mover 20% da carga do DC Paulista para o DC Orlando</p>
      <p>âš  Anomalia detectada: aumento de 12% de latÃªncia no DC RÃºssia nas Ãºltimas 3h</p>
      <p>ðŸŸ© Orlando estÃ¡ apto para receber novas instÃ¢ncias</p>
      <p>ðŸª« Paulista perto do limite de disco (82%)</p>
    </div>
  </div>
  <footer>
    <div class="dashButtons">
      <a href="./home.html"><img style="border-radius: 0 !important" src="../../Images/home.svg" alt=""></a>
      <a href="./Ally.html"><img src="../../Images/Colaboradores/Colaborador1.svg" alt=""></a>
      <a href="./Gustavo.html"><img src="../../Images/Colaboradores/Colaborador2.svg" alt=""></a>
      <a href="./Leonardo.html"><img src="../../Images/Colaboradores/Colaborador3.svg" alt=""></a>
      <a href="./Maria.html"><img src="../../Images/Colaboradores/Colaborador4.svg" alt=""></a>
      <a href="./Pedro.html"><img src="../../Images/Colaboradores/Colaborador5.svg" alt=""></a>
    </div>
    <p>Developed by <a href="https://www.linkedin.com/in/ally-awada">AllyAwada</a></p>
  </footer>
</body>

</html>

<script>
  // Inicializa o mapa no centro do mundo
  var map = L.map('map', {
    zoomControl: false,       // remove o controle de zoom
    attributionControl: false // remove crÃ©ditos extras
  }).setView([20, 0], 2);

  // Tile minimalista igual ao mockup
  L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
    maxZoom: 20
  }).addTo(map);

  // FunÃ§Ã£o dos marcadores estilo bolinha colorida
  function marker(color) {
    return L.divIcon({
      className: "",
      html: `<div class="marker-dot" style="background:${color}"></div>`,
      iconSize: [16, 16],
      iconAnchor: [8, 8]
    });
  }

  // Coordenadas dos datacenters
  let datacenters = [
    { nome: "Orlando", lat: 28.5383, lng: -81.3792, cor: "#00D4C4" },
    { nome: "Paulista", lat: -23.5505, lng: -46.6333, cor: "#FFB94A" },
    { nome: "RÃºssia", lat: 55.7558, lng: 37.6173, cor: "#FF3F72" }
  ];

  // Adiciona os marcadores
  datacenters.forEach(dc => {
    L.marker([dc.lat, dc.lng], { icon: marker(dc.cor) })
      .addTo(map)
      .bindPopup(`<b>${dc.nome}</b>`);
  });
</script>

<script src="../../js/sidebar.js"></script>
<script src="../../js/popups.js"></script>
<script src="../../js/verificacaoPermissoes.js"></script>
<script>
  window.onload(rankingDataCenter());
  if (sessionStorage.empresaCnpj == undefined) {
    listarPermissoesReload();
    verificarPermissoesSideBar();
    setInterval(executarVerificacaoPermissoes, 30000);
  }

  function executarVerificacaoPermissoes() {
    if (sessionStorage.empresaCnpj == undefined) {
      listarPermissoesReload();
      verificarPermissoesSideBar();
    }
  }

  if (sessionStorage.empresaCnpj == undefined) {
    verificarPermissoesSideBar();
  }
  function rankingDataCenter() {
    rankDatacenter.innerHTML = "";
    var datacenters = [{
      nome: "Datacenter Orlando",
      media: 99.54,
      diferenca: 1.54,
      up: true
    }, {
      nome: "Datacenter Paulista",
      media: 72,
      diferenca: 5,
      up: true
    }, {
      nome: "Datacenter Russia",
      media: 65.98,
      diferenca: 5.4,
      up: false
    }, {
      nome: "Datacenter Paulista",
      media: 72,
      diferenca: 5,
      up: true
    }, {
      nome: "Datacenter Russia",
      media: 65.98,
      diferenca: 5.4,
      up: false
    }, {
      nome: "Datacenter Paulista",
      media: 72,
      diferenca: 5,
      up: true
    }, {
      nome: "Datacenter Russia",
      media: 65.98,
      diferenca: 5.4,
      up: false
    }, {
      nome: "Datacenter Paulista",
      media: 72,
      diferenca: 5,
      up: true
    }, {
      nome: "Datacenter Russia",
      media: 65.98,
      diferenca: 5.4,
      up: false
    }];

    for (let i = 0; i < datacenters.length; i++) {

      let estado = "";
      let iconStatus = "";

      if (datacenters[i].media >= 90) {
        estado = "ok";
        iconStatus = "ok.svg";
      } else if (datacenters[i].media >= 70) {
        estado = "alerta";
        iconStatus = "alerta.svg";
      } else {
        estado = "critico";
        iconStatus = "critico.svg";
      }
      let clsComparativo = datacenters[i].up ? "comparativo_up" : "comparativo_down";
      let iconComparativo = datacenters[i].up ? "lineUp.svg" : "lineDown.svg";

      rankDatacenter.innerHTML += `
      <div class="popup">
        <div class="status status_${estado}">
          <img src="../../Images/PopUpsDash/${iconStatus}" alt="">
        </div>
        <div class="contentDc">
          <div class="first">
            <img class="icon" src="../../Images/PopUpsDash/iconDc.svg" alt="">
              <p>${datacenters[i].nome}</p>
          </div>
          <div class="seccond seccond_${estado}">
            <h3 class="kpi">${datacenters[i].media}%</h3>
            <section class="comparativo ${clsComparativo}">
              <p class="kpi">
                <img src="../../Images/PopUpsDash/${iconComparativo}" alt="">
                  ${datacenters[i].diferenca}%
              </p>
              <p>vs Ãºltima semana</p>
            </section>
          </div>
        </div>
      </div>`;
    }
  }
</script>

<script>
  const data = {
    labels: ["SaÃºde", "Disco", "RAM", "CPU", "Rede"],
    datasets: [
      {
        label: "Datacenter paulista",
        data: [75, 60, 85, 70, 65],
        backgroundColor: "rgba(255, 185, 74, 0.2)",
        fill: true,
        borderColor: "#FFB94A"

      },
      {
        label: "Limites",
        data: [82, 70, 68, 80, 88],
        backgroundColor: "rgba(31, 84, 126, 0.2)",
        fill: true,
        borderColor: "#1F547E"
      }
    ]
  };

  const radarConfig = {
    type: "radar",
    data: data,
    options: {
      responsive: false,
      plugins: {
        legend: {
          labels: {
            color: "#1F547E"
          }
        }
      },
      scales: {
        r: {
          grid: {
            color: "#E5E4E2"
          },
          pointLabels: {
            color: "#1F547E"
          },
          suggestedMin: 0,
          suggestedMax: 100
        }
      }
    }
  };

  new Chart(document.getElementById("radarChart"), radarConfig);

</script>