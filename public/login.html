<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">
    <script defer src="js/cadlogin.js"></script>
    <title>Página de Login e Cadastro</title>
</head>

<body>

    <div class="container" id="container">
        <div class="form-container sign-up">
            <form>
                <h1>Criar Conta</h1>
                <span>Preencha os dados abaixo para se cadastrar</span>

                <input type="text" placeholder="Nome da Empresa" required>
                <input type="text" placeholder="CNPJ" required>
                <input type="email" placeholder="E-mail" required>
                <select required>
                    <option value="">Selecione o Cargo</option>
                    <option value="admin">Admin</option>
                    <option value="user">Usuário</option>
                </select>
                <input type="password" placeholder="Senha" required>
                
                <button type="submit">Inscrever</button>
            </form>
        </div>

        <div class="form-container sign-in">
            <form>
                <h1>Entrar</h1>
                <span>Digite seu e-mail e senha para acessar</span>

                <input type="email" placeholder="E-mail" required>
                <input type="password" placeholder="Senha" required>
                <a href="#">Esqueceu sua senha?</a>
                
                <button type="submit">Entrar</button>
            </form>
        </div>

        <div class="toggle-container">
            <div class="toggle">
                <div class="toggle-panel toggle-left">
                    <img src="Logo Azul.png" alt="Logo" class="logo">
                    <p>Bem-vindo de volta!</p>
                    <p>Insira seus dados para acessar todos os recursos do site</p>
                    <button id="login">Entrar</button>
                </div>
                <div class="toggle-panel toggle-right">
                    <img src="Logo Azul.png" alt="Logo" class="logo">
                    <p>Olá!</p>
                    <p>Cadastre-se para acessar todos os recursos do site.</p>
                    <button id="register">Inscrever</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>

<script>
    //Script de validação dos formulários bootstrap
    (() => {
        'use strict'

        const forms = document.querySelectorAll('.needs-validation')

        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    event.preventDefault();
                    login();
                }

                form.classList.add('was-validated');
            }, false);
        });
    })();

    async function login() {
        let usuarioEmail = await floatingEmail.value;
        let usuarioSenha = await floatingPassword.value;

        console.log(usuarioEmail);
        console.log(usuarioSenha);

        let respostaLogin = await fetch(`/usuarios/autenticar/${usuarioEmail}/${usuarioSenha}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application-json' 
            }
        });

        if(!respostaLogin.ok) {
            respostaLogin.text().then(texto => {
                erroLogin.innerHTML = `<img src="/assets/loginAlert.png"><p>${texto}</p>`;
            });

            return;
        }

        let jsonLogin = await respostaLogin.json();

        console.log(jsonLogin);

        sessionStorage.EMAIL_USUARIO = jsonLogin.email;
        sessionStorage.NOME_USUARIO = jsonLogin.nome;
        sessionStorage.ID_USUARIO = jsonLogin.idUsuario;
        sessionStorage.ID_EMPRESA = jsonLogin.fkEmpresa;

        window.location = "dashboard.html";
    }
</script>